void lock(int *l) {
while (compare_and_swap(l, 0, 1)) {
    // add myself to the lock wait queue
    thread_sleep(); }}
void unlock(int *l) { *l = 0;
if (/* threads in wait queue */) {
    // wake up one thread
}}
